# Module 11: Automating Integration with Azure Resources

# Lab: Automating the Creation of a Test Environment using PowerShell

## Exercise 1: Preparing the Azure PowerShell Environment

#### Task 1: Open the Azure PowerShell Console

1.  On the Start screen, click the down arrow to view all the applications, and then click **Microsoft Azure PowerShell**.

2.  Switch to the **Microsoft Azure PowerShell** window.

#### Task 2: Import your Azure subscription by using a Publish Settings file

1.  To get your publish settings file, type the following command in the console, and then press **Enter**:

    ```
          Get-AzurePublishSettingsFile
    ```

2.  In the **Internet Explorer** tab that opens, perform the following steps:

3.  Enter the email address of your Microsoft account.

4.  Click Continue.

5.  Enter the password for your Microsoft account.

6.  Click **Sign In**.

    > At the bottom of the Internet Explorer window, click the arrow that is on the right side of the **Save** button, and then click **Save As** in the download dialog box.

7.  In the **Save As** dialog box that displays, perform the following steps:

    a. Go to the AllFiles (F):\\Mod11\\Labfiles folder.

    b. In the **File Name** box, type **20532**.

    c. In the **Save as type** box, ensure that the **PUBLISHSETTINGS File** option is selected.

    d. Click **Save**.

    e. Close Internet Explorer.

    f. Switch to the **Microsoft Azure PowerShell** application.

8.  To import your publish settings file, type the following command in the console, and then press Enter:

    ```
     Import-AzurePublishSettingsFile F:\\Mod11\\Labfiles\\20532.publishsettings
    ```

9.  To view your account details, type the following command in the console, and then press Enter:

    ```
      Get-AzureAccount
    ```

> **Note:** If you have multiple Azure subscriptions, you can use **Select-AzureSubscription** to select the appropriate subscription. If your Azure subscription is provided by a Learning Partner, it might be an auto-generated account without any details. In such a case, this command will return an empty result.
>
> **Results**: After completing this exercise, you will have set up a development environment to use Windows PowerShell for Azure service automation.

## Exercise 2: Using Windows PowerShell to create and access a Website instance

#### Task 1: Create a new Website instance by using Windows PowerShell

1.  To create a new Website, type the following command in the console by providing the unique name selected for your Website, and then press Enter:

```
        New-AzureWebsite [Unique Name] >  **Note:** You might get an error message notifying you that your Website’s name is not unique. If this occurs, select a new name until your Website is created.
```

1.  To view a list of your Websites, type the following command in the console, and then press Enter:

    ```
         Get-AzureWebsite
    ```

2.  To get the details for your new Website, type the following command in the console by providing the unique name selected for your Website, and then press Enter:

    ```
         Get-AzureWebsite –Name [Unique Name]
    ```

3.  Record the **hostname** value from the list of key-value pairs that are generated by the previous command.

4.  To view the new Website in Internet Explorer, type the following command in the console, and then press Enter:

    ```
    explorer “http://[Host Name]”
    ```

5.  Verify that the new Website is running.

6.  Close Internet Explorer.

7.  Switch to the **Microsoft Azure PowerShell** console window.

#### Task 2: Remove a Website instance by using Windows PowerShell

1.  To stop your new Website, type the following command in the console by providing the unique name selected for your Website, and then press Enter:

    Stop-AzureWebsite –Name \[Unique Name\]

2.  To view the list of your Websites, type the following command in the console, and then press Enter:

    ```
    Get-AzureWebsite
    ```

3.  To remove your new Website, type the following command in the console by providing the unique name selected for your Website, and then press Enter:

    ```
    Remove-AzureWebsite –Name [Unique Name]
    ```

4.  Type **Y** to indicate that you want to remove the Website, and then press Enter.

5.  To verify that your Website is removed, type the following command in the console by providing the unique name selected for your Website, and then press Enter. The result should be empty:

    ```
    Get-AzureWebsite –Name [Unique Name]
    ```

> **Results**: After completing this exercise, you will have used Windows PowerShell to manage instances of an Azure service.

## Exercise 3: Using a resource template to create multiple preconfigured resources

#### Task 1: Switch to the Azure Resource Manager PowerShell Modules

1.  To switch modules, type the following command in the console, and then press Enter:

    ```
    Login-AzureRmAccount
    ```

2.  In the **Sign in to Windows Azure** dialog box, perform the following steps:

    a. Enter the email address of your Microsoft account.

    b. Enter the password for your Microsoft account.

    c. Click **Sign In**.

3.  To view your current Azure PowerShell session context type the following command in the console, and then press Enter:

    ```
    Get-AzureRmContext
    ```

> **Note:** If you have multiple Azure subscriptions, you can use **Select-AzureSubscription** to select the appropriate subscription.

#### Task 2: Create a resource group by using Windows PowerShell

1.  To create a new instance of a resource group from the template, type the following command in the console, and then press Enter:

    ```
    New-AzureRmResourceGroup -Name rga20532 -Location "West US"
    ```

<!-- -->

1.  To provide the parameters for the template, type the following command in the console, perform the following steps:

    ```
    New-AzureRmResourceGroupDeployment -ResourceGroupName rga20532 -TemplateUri https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/201-web-app-sql-database/azuredeploy.json
    ```

    a. For the **siteName**

    ```
    prompt, provide the value **rs20532[*Your Name Here*]**, and pressEnter.
    ```

    b. For the **hostingPlanName**

    ```
    prompt, provide the value **rp20532[*Your Name Here*]**, and then pressEnter.
    ```

    c. For the **siteLocation**

    ```
    prompt, provide the value **West US**, and then press Enter.
    ```

    d. For the **serverName** prompt,

    ```
    provide the value **rv20532[*Your Name Here*]**, and then press Enter.
    ```

    e. For the **serverLocation**

    ```
    prompt, provide the value **West US**, and then press Enter.
    ```

    f. For the **administratorLogin**

    ```
    prompt, provide the value **testuser,** and then press Enter.
    ```

    g. For the

    ```
    **administratorLoginPassword** prompt, provide the value**TestPa\$\$w0rd**, and press Enter.
    ```

    h. For the **databaseName**

    ```
    prompt, provide the value **rd20532[*Your Name Here*]**, and pressEnter.
    ```

    > **Note:** Wait for the provisioning process to complete. Status messages will be displayed periodically and the final message with the details will be displayed when provisioning is complete.

2.  To get the details of your new resource group, type the following command in the console by providing the unique name selected for your Website, and then press Enter:

    ```
    Get-AzureRmResourceGroup –ResourceGroupName rga20532
    ```

3.  To get the details of your new Website, type the following command in the console by providing the unique name selected for your Website, and then press Enter:

    ```
    (Get-AzureRmResource -Name rs20532[Your Name Here] -ResourceGroupName rga20532 -ResourceType "Microsoft.Web/sites" -ApiVersion 2015-08-01).Properties
    ```

4.  Record the single value in the **HostNames** array from the JSON data generated by the previous command.

5.  To view the new Website in Internet Explorer, type the following command in the console, and then press Enter:

    ```
        explorer “http://[Host Name]”
    ```

6.  Verify that the new Website is running.

7.  Close Internet Explorer.

8.  Switch to the **Microsoft Azure PowerShell** console window.

#### Task 3: Remove the resource group by using Windows PowerShell

1.  To remove your new resource group, type the following command in the console, and then press Enter:

    ```
    Remove-AzureRmResourceGroup –Name rga20532
    ```

2.  Type **Y** to indicate that you want to remove the Website, and then press Enter.

    > **Note:** Because removing a resource group involves removing multiple resources, this process can take 5 to 15 minutes on average.

3.  Close the **Microsoft Azure PowerShell** console window.

> **Results**: After completing this exercise, you will have used Azure to interact with the Resource Manager, resource groups, and resource group templates.

©2014 Microsoft Corporation. All rights reserved. The text in this document is available under the [Creative Commons Attribution 3.0 License](https://creativecommons.org/licenses/by/3.0/legalcode), additional terms may apply. All other content contained in this document (including, without limitation, trademarks, logos, images, etc.) are ***not*** included within the Creative Commons license grant. This document does not provide you with any legal rights to any intellectual property in any Microsoft product. You may copy and use this document for your internal, reference purposes.

This document is provided "as-is." Information and views expressed in this document, including URL and other Internet Web site references, may change without notice. You bear the risk of using it. Some examples are for illustration only and are fictitious. No real association is intended or inferred. Microsoft makes no warranties, express or implied, with respect to the information provided here.
