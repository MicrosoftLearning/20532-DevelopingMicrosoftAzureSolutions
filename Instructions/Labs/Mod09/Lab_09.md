# Module 9: Automating Integration with Azure Resources

# Lab: Automating the Creation of Azure Assets using PowerShell and the Azure CLI

### Scenario

Insert scenario here

### Objectives

After you complete this lab, you will be able to:

- Task 1

- Task 2

- Task 3

### Lab Setup

- *Estimated Time*: 90 minutes

For this lab, you will use the available host machine. Before you begin this lab, you must complete the following steps:

1. Setup 1

## Exercise 1: Use Azure CLI to Create and Manage an Azure Web App

### Scenario

Insert Scenario here

The main tasks for this exercise are as follows:

1. 

#### Task 1: Preparing the Azure CLI Environment

1. Go to *(<https://aka.ms/installazurecliwindows>)*.

1. Install the **azure-cli** MSI installer.

1. Wait for the installation process to complete.

1. Open **Command Prompt**.

1. Validate that the **azure** CLI command is available with the following command:
    
    ```
    az --help
    ```
    
#### Task 2: Login to Your Azure Subscription Using Interactive Login

1. Use the following command to login:
       
    ```
    az login
    ```
       
1. Follow instructions to complete the authentication process.

1. Validate that process was successful with the following command:

    ```
    az account list
    ```

    > **Note**: If you have multiple Azure subscriptions, you can use **az account set --subscription [subscription-name]** to select the appropriate subscription. If you are unsure about your subscription's name, you can simply use **az account list**. If your Azure subscription is provided by a Learning Partner, it might be an auto-generated account without any details. In such a case, this command will return an empty result.


#### Task 3: Create a New Web App

1. Using command prompt, create a new resourch group with the following details:

    - Name: MOD09ZCLI

    - Location: West US

1. view the list of your research groups.

1. Using command prompt, create a new **App Service Plan** with the following details:

    - Name: InexpensivePlan

    - Resource Group: MOD09ZCLI

    - OS: Linux

    - Pricing Tier: B1

    ```
    az appservice plan create --resource-group MOD09ZCLI --name InexpensivePlan --is-linux --sku B1
    ```

1. Using command prompt, create a new **Web App** using the following details

    - Name: Any unique name

    - Resource Group: MOD09ZCLI

    - App Service plan: InexpensivePlan

    - Runtime Stack: node|6.2

1. Use the command prompt to pull the details of the newly created *website*

1. Record the **defaultHostName** value from the list of key-value pairs that are generated.

1. Access the **defaultHostName** on internet explorer to verify the web app is running.

1. Close Internet explorer.

1. To create a new App Service Plan Resource, type the following command in the console and then press Enter:

    ```
    az appservice plan create --resource-group MOD09ZCLI --name InexpensivePlan --is-linux --sku B1
    ```

1. To create a new Web App Resource, type the following command in the console by providing the unique name selected for your Web App and then press Enter:

    ```
    az webapp create --name [Unique Name] --resource-group MOD09ZCLI --plan InexpensivePlan --runtime "node|6.2"
    ```

    > **Note**: You might get an error message notifying you that your Web App's name is not unique. If this occurs, select a new name until your Website is created.

1. To view a list of Resources in the **MOD09ZCLI** Resource Group, type the following command in the console, and then press Enter:

    ```
    az resource list --resource-group MOD09ZCLI
    ```

1. To get the details for your new Website, type the following command in the console by providing the unique name selected for your Website, and then press Enter:

    ```
    az resource show --name [Unique Name] --resource-type "Microsoft.Web/Sites" --resource-group MOD09ZCLI
    ```

1. Record the **defaultHostName** value from the list of key-value pairs that are generated by the previous command.

    > **Note**: this hostname property will look similar to this: ``"defaultHostName": "websitepiaxfa4veu6lw.azurewebsites.net"``.

1. To view the new Web App in Internet Explorer, type the following command in the console, and then press Enter:

    ```
    explorer "http://[Host Name]"
    ```

1. Verify that the new Web App is running.

1. Close Internet Explorer.

1. Switch to the **Command Prompt** console window.

#### Task 4: Remove a Resource Group

1. To remove your Resource Group, type the following command in the console by providing the name **MOD09ZCLI**, and then press Enter:

    ```
    az group delete --name MOD09ZCLI  
    ```

1. Type **Y** to indicate that you want to remove the Resource Group, and then press Enter.

1. To verify that your Resource Group has been removed and then press Enter. The resulting array should not include the **MOD09ZCLI** Resource Group:

    ```  
    az group list
    ```

> **Results**: After completing this exercise, you will have used the Azure CLI to manage instances of an Azure service.

## Exercise 2: Use PowerShell to Create and Manage an Azure Storage Account

#### Task 1: Open the Azure PowerShell Console

1. On the Start screen, click the down arrow to view all the applications, and then click **Windows PowerShell**.

1. Switch to the **Windows PowerShell** window.

#### Task 2: Authenticate to Azure Resource Manager Using PowerShell

1. To switch modules, type the following command in the console, and then press Enter:

    ```
    Login-AzureRmAccount
    ```

1. In the **Sign in to your account** dialog box, perform the following steps:

    a. Enter the email address of your Microsoft account.

    a. Click **Next**.

    a. Enter the password for your Microsoft account.

    a. Click **Sign In**.

1. To view your current Azure PowerShell session context type the following command in the console, and then press Enter:

    ```
    Get-AzureRmContext
    ```

> **Note**: If you have multiple Azure subscriptions, you can use **Select-AzureRmSubscription** to select the appropriate subscription.

#### Task 3: Create a resource group by using PowerShell

1. To create a new instance of a resource group from the template, type the following command in the console, and then press Enter:

    ```
    New-AzureRmResourceGroup -Name MOD09ZPSH -Location "West US"
    ```

1. To provide the parameters for the template, type the following command in the console, and then perform the following steps:

    ```
    New-AzureRmResourceGroupDeployment -ResourceGroupName MOD09ZPSH -TemplateFile "F:\Mod09\Labfiles\Starter\azuredeploy.json"
    ```

    a. For the **administratorLogin** prompt, provide the value **testuser**, and then press Enter.

    a. For the **administratorLoginPassword** prompt, provide the value **TestPa$$w0rd**, and press Enter.

    > **Note**: Wait for the provisioning process to complete. Status messages will be displayed periodically and the final message with the details will be displayed when provisioning is complete.

1. To get the details of your new resource group, type the following command in the console by providing the unique name selected for your Website, and then press Enter:

    ```
    Get-AzureRmResourceGroup –ResourceGroupName MOD09ZPSH
    ```

1. To get the details of your new Website, type the following command in the console by providing the unique name selected for your Website, and then press Enter:

    ```
    (Get-AzureRmResource -IsCollection -ResourceGroupName MOD09ZPSH -ResourceType "Microsoft.Web/sites" -ApiVersion 2016-08-01).Properties
    ```

1. Record the value of the **hostNames** property from the JSON data generated by the previous command.

    > **Note**: this hostname property will look similar to this: ``DefaultHostName : websitepiaxfa4veu6lw.azurewebsites.net``.

1. To view the new Website in Internet Explorer, type the following command in the console, and then press Enter:

    ```
    explorer "http://[Host Name]"
    ```

1. Verify that the new Website is running.

1. Close Internet Explorer.

1. Switch to the **Windows PowerShell** console window.

#### Task 4: Remove the resource group by using PowerShell

1. To remove your new resource group, type the following command in the console, and then press Enter:

    ```
    Remove-AzureRmResourceGroup –Name MOD09ZPSH
    ```

1. Type **Y** to indicate that you want to remove the Website, and then press Enter.

    > **Note**: Because removing a resource group involves removing multiple resources, this process can take 5 to 15 minutes on average.

1. Close the **Windows PowerShell** console window.

> **Results**: After completing this exercise, you will have used Azure to interact with the Resource Manager, resource groups, and resource group templates.